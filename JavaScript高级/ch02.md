# （二） 内存管理

## 1. 什么是内存管理

不管什么样的编程语言，在代码的**执行过程中**都是需要给它分配内存的，不同的是某些编程语言需要我们自己手动的管理内存，某些编程语言会可以自动帮助我们管理内存

### 1.1 内存管理的生命周期

1. 分配申请需要的内存
2. 使用分配的内存
3. 不需要使用时，对其进行释放

> [!NOTE]
> 不同的编程语言对于第一步和第三步有不同的方式
> 
> 如 C 、C++ 等需要手动管理内存（malloc 和 free 函数）
> 
> 如 Java 、 JavaScript 等可以自动管理内存

## 2. JavaScript 的内存管理

> JavaScript 会在定义变量时分配内存

1. JS对于<span style="color: red;">基本数据类型内存</span>的分配会在执行时， 直接在栈空间进行分配
2. JS对于<span style="color: red;">复杂数据类型内存</span>的分配会在堆内存中开辟一块空间，并且将这块空间的指针返回值变量引用

## 3. JavaScript 的垃圾回收

> 因为內存的大小是有限的，所以当内存不再需要的时候，我们需要对其进行释放，以便腾出更多的内存空间。

1. 在手动管理内存的语言中，我们需要通过一些方式自己来释放不再需要的内存，比如free函数
   1. 但是这种管理的方式其实非常的低效，影响我们编写逻辑的代码的效率
   2. 并且这种方式对开发者的要求也很高，并且一不小心就会产生內存泄露

2. 大部分现代的编程语言都有自己的垃圾回收机制
   1. 垃圾回收的英文是<span style="color: red;">Garbage Collection</span>，简称GC
   2. 对于那些<span style="color: red;">不再使用的对象</span>，我们都称之为是垃圾，它需要被回收，以释放更多的内存空间
   3. 语言的运行环境，比如Java的运行环境JVM，JavaScript的运行环境js引擎都会有内存垃圾回收器
   4. 垃圾回收器我们也会简称为GC，所以在很多地方你看到GC其实指的是垃圾回收器

## 4. GC 算法

### 4.1 引用计数

当一个对象有一个引用指向它时，那么这个对象的引用就+1，当一个对象的引用为0时，这个对象就可以被销毁掉

> [!DANGER]
> 引用计数有一个会产生循环引用的弊端
> ```js
var obj1 = { friend: obj2 }
var obj2 = { friend: obj1 }

### 4.2 标记清除

这个算法是设置一个根对象(root object），垃圾回收器会定期从这个根开始，找所有从根开始有引用到的对象，对于那些没有引用到的对象，就认为是不可用的对象

**同时，该算法可以很好的解决循环引用的弊端**

![](https://i0.hdslb.com/bfs/album/13b114f0e3bb918650b6f2acad48ea94b15bd9af.png)

